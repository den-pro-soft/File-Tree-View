{% load static %}
<html>
	<head>
		<title>File Explorer</title>
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet"/>
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.8.1/bootstrap-table.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.8.1/bootstrap-table.min.js"></script>

		<link rel="stylesheet" href="{% static 'jstree/themes/default/style.min.css' %}" />
		<link rel="stylesheet" href="{% static 'app/css/style.css' %}" />
  		<script src="{% static 'jstree/jstree.min.js' %}"></script>
	</head>
	<body>
		<div class="container-fx">
			<div class="row">
				<div class="col-md-4 tree_panel">
					<div id="jstree"></div>
				</div>
				<div class="col-md-8 data_table">
					<div class="row">
						<div class="col-md-6" id="total_list_size">Total List Size: 0</div>
						<div class="col-md-6" id="total_size">Total Size: 0</div>
					</div>
					<table
						id="eventsTable"
					   	data-toggle="table">
					    <thead>
					      	<tr>
        						<th ></th>
								<th data-field="icon">icon</th>
								<th data-field="filename">filename</th>
								<th data-field="size">size</th>
								<th data-field="type">type</th>
								<th data-field="last modified">last modified</th>
					      	</tr>
					    </thead>
					    <tbody>
					    </tbody>
				  	</table>
				</div>
			</div>
		</div>
		<script>
			$(function () {
				var total_size = 0;
				var total_list_size = 0;
				var checkedRows = [];

				$('#jstree')
					.jstree({
					  	"core" : {
						    "animation" : 0,
						    "check_callback" : true,
						    "themes" : { "stripes" : true },
						    "data" : {
						      	'url' : function (node) {
							        return node.id === '#' ?
						          		'{% url "get_roots" %}' : '{% url "get_children" %}?id='+node.id;
						      	}
						    }
					  	},
						"checkbox" : {
							"keep_selected_style" : false,
					      	whole_node : false,
					      	tie_selection : false,
							three_state : false
						},
						"plugins" : [ "checkbox" ]
					})
					.on('select_node.jstree', function (e, data) {
						$("#eventsTable tbody").empty();
						$.ajax({
							url: '{% url "get_listdata" %}?node_id='+data.node.id,
							success: function(result){
							  	$.each(result, function(key, value) {
									var bef_str = "{% static ";
									var lst_str = " %}";

									$("<tr />")
										.append(
											$('<td/>', {
												class: 'bs-checkbox'
											})
											.append(
												$("<input/>", {
													type: 'checkbox',
													name: 'btSelectItem',
													style: 'margin-top: 10px !important;',
													dataIndex: key,
													click: function() {
														if ($(this).is(':checked')) {
															if($.isNumeric(value['size']))
																total_size += parseInt(value['size']);
														}
														else {
															if($.isNumeric(value['size']))
																total_size -= parseInt(value['size']);
														}
														$("#total_size").html("Total Size: " + total_size);
													}
												})
											)
										)
										.append(
									  		$("<td />")
											.append(
												$("<img/>", {
													src: value['icon'],
													name: "icon",
													style: "width: 10%"
												})
											)
										)
										.append(
									  		$("<td />").html(value['filename'])
										)
										.append(
										  	$("<td />").html(value['size'])
										)
										.append(
									  		$("<td />").html(value['type'])
										)
										.append(
									  		$("<td />").html(value['last modified'])
										)
										.appendTo("#eventsTable tbody");
							   	});

								$('#eventsTable tbody tr input[type=checkbox]').click(function(event) {
							        if (event.target.type !== 'checkbox') {
							            $(':checkbox', this).trigger('click');
							        }
							    });

							  	$('#eventsTable tbody tr').click(function(event) {
								    if (event.target.type !== 'checkbox') {
								      $(':checkbox', this).trigger('click');
								    }
							  	});
					    	}
						});
				})
				.on('loaded.jstree', function() {
					$.jstree.reference('#jstree').select_node('tree-#');
				})
				.on("check_node.jstree uncheck_node.jstree", function(e, data) {
					total_list_size = 0;
					var check_list = $("#jstree").jstree("get_checked", true);

					if(check_list.length) {
						$.each(check_list, function(key, value) {
							$.ajax({
								url: '{% url "get_listdata" %}?node_id='+value.id,
								success: function(result){
								  	$.each(result, function(key, value) {
										if($.isNumeric(value['size']))
										{
											total_list_size += parseInt(value['size']);
										}
									});
									$("#total_list_size").html("Total List Size: " + total_list_size);
								}
							});
						});
					}
					else {
						$("#total_list_size").html("Total List Size: " + total_list_size);
					}

				})
			});
		</script>
	</body>
</html>
