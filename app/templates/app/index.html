{% load static %}
<html>
	<head>
		<title>File Explorer</title>
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet"/>
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.8.1/bootstrap-table.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.8.1/bootstrap-table.min.js"></script>

		<link rel="stylesheet" href="{% static 'jstree/themes/default/style.min.css' %}" />
		<link rel="stylesheet" href="{% static 'app/css/style.css' %}" />
  		<script src="{% static 'jstree/jstree.min.js' %}"></script>
	</head>
	<body>
		<div class="container-fx">
			<div class="row">
				<div class="col-md-4 tree_panel">
					<div id="jstree"></div>
				</div>
				<div class="col-md-8 data_table">
					<table
						id="eventsTable"
					   	data-toggle="table">
					    <thead>
					      	<tr>
        						<th ></th>
								<th data-field="icon" data-sortable="true">icon</th>
								<th data-field="filename" data-sortable="true">filename</th>
								<th data-field="size" data-sortable="true">size</th>
								<th data-field="type" data-sortable="true">type</th>
								<th data-field="last modified" data-sortable="true">last modified</th>
					      	</tr>
					    </thead>
					    <tbody>
					    </tbody>
				  	</table>
				</div>
			</div>
		</div>
		<script>
			$(function () {
				var checkedRows = [];

				// $("#add_cart").click(function() {
			  	// 	$("#output").empty();
			  	// 	$.each(checkedRows, function(index, value) {
			    // 		$('#output').append($('<li></li>').text(value.id + " | " + value.name + " | " + value.forks));
			  	// 	});
				// });

				$.ajax({
					url: '{% url "get_listdata" %}?node_id=rootdir',
					success: function(result){
						$("#eventsTable tbody").empty();
						$.each(result, function(key, value) {
							var tr = $("<tr />");
							tr.append("<td class='bs-checkbox'><input type='checkbox' name='btSelectItem' data-index='"+key+"' /> </td>");
							tr.append(
							  $("<td />", {
								html: value['icon']
							   })[0].outerHTML
							);
							tr.append(
							  $("<td />", {
								html: value['filename']
							   })[0].outerHTML
							);
							tr.append(
							  $("<td />", {
								html: value['size']
							   })[0].outerHTML
							);
							tr.append(
							  $("<td />", {
								html: value['type']
							   })[0].outerHTML
							);
							tr.append(
							  $("<td />", {
								html: value['last modified']
							   })[0].outerHTML
							);
							$("#eventsTable tbody").append(tr)
						});
						$('#eventsTable tbody tr input[type=checkbox]').click(function(event) {
							if (event.target.type !== 'checkbox') {
								$(':checkbox', this).trigger('click');
							}
						});

						$('#eventsTable tbody tr').click(function(event) {
							if (event.target.type !== 'checkbox') {
								$(':checkbox', this).trigger('click');
							}
						});
						$('#eventsTable').on('check.bs.table', function (e, row) {
							checkedRows.push({id: row.id, name: row.name, forks: row.forks});
						});

						$('#eventsTable').on('uncheck.bs.table', function (e, row) {
							$.each(checkedRows, function(index, value) {
								if (value.id === row.id) {
								  checkedRows.splice(index,1);
								}
							});
						});
					}
				});
				$('#jstree').jstree({
				  "core" : {
				    "animation" : 0,
				    "check_callback" : true,
				    "themes" : { "stripes" : true },
				    "data" : {
				      	'url' : function (node) {
					        return node.id === '#' ?
				          		'{% url "get_roots" %}' : '{% url "get_children" %}?id='+node.id;
				      	},
				      	'data' : function (node, callback) {
				      	}
				    }
				  },
				  "checkbox" : { "keep_selected_style" : false },
				  "plugins" : [ "checkbox" ]
				});
				$('#jstree').on('select_node.jstree', function (e, data) {
					$("#eventsTable tbody").empty();
					$.ajax({
						url: '{% url "get_listdata" %}?node_id='+data.node.id,
						success: function(result){
						  	$.each(result, function(key, value) {
								var tr = $("<tr />");
								tr.append(
								  $("<td />", {
									html: "<input type='checkbox' class='checkbox-inline'/>"
								   })[0].outerHTML
								);
								tr.append(
								  $("<td />", {
									html: value['icon']
								   })[0].outerHTML
								);
								tr.append(
								  $("<td />", {
									html: value['filename']
								   })[0].outerHTML
								);
								tr.append(
								  $("<td />", {
									html: value['size']
								   })[0].outerHTML
								);
								tr.append(
								  $("<td />", {
									html: value['type']
								   })[0].outerHTML
								);
								tr.append(
								  $("<td />", {
									html: value['last modified']
								   })[0].outerHTML
								);
								$("#eventsTable tbody").append(tr)
						   	})

							$('#eventsTable tbody tr input[type=checkbox]').click(function(event) {
						        if (event.target.type !== 'checkbox') {
						            $(':checkbox', this).trigger('click');
						        }
						    });

						  	$('#eventsTable tbody tr').click(function(event) {
							    if (event.target.type !== 'checkbox') {
							      $(':checkbox', this).trigger('click');
							    }
						  	});
							$('#eventsTable').on('check.bs.table', function (e, row) {
							  	checkedRows.push({id: row.id, name: row.name, forks: row.forks});
							  	console.log(checkedRows);
							});

							$('#eventsTable').on('click-row.bs.table', function (e, row, $element) {
							    // console.log(row, $element);
								console.log("Hello");
							});

							$('#eventsTable').on('uncheck.bs.table', function (e, row) {
							  	$.each(checkedRows, function(index, value) {
								    if (value.id === row.id) {
								      checkedRows.splice(index,1);
								    }
						  		});
						  		console.log(checkedRows);
							});
				    	}
					});
					// $("#list_table").DataTable ({
					// 	"ajax" : '{% url "get_listdata" %}?node_id=' + data.node.id,
					// 	'columnDefs': [{
					//         'targets': 0,
					//         'searchable':false,
					//         'orderable':false,
					//         'width':'1%',
					//         'className': 'dt-body-center',
					//         'render': function (data, type, full, meta){
					//             return '<input type="checkbox">';
					//         }
					//     }],
					//     'order': [1, 'asc'],
					//     'rowCallback': function(row, data, dataIndex){
					//         // Get row ID
					//        	var rowId = data[0];
                    //
					//         // If row ID is in the list of selected row IDs
					//         if($.inArray(rowId, rows_selected) !== -1){
					//             $(row).find('input[type="checkbox"]').prop('checked', true);
					//             $(row).addClass('selected');
					//         }
					//     }
					// });
				});



				// $('#list_table tbody').on('click', 'input[type="checkbox"]', function(e){
				//     var $row = $(this).closest('tr');
                //
				//       // Get row data
			    //   	var data = table.row($row).data();
                //
				//       // Get row ID
			    //   	var rowId = data[0];
                //
				//       // Determine whether row ID is in the list of selected row IDs
				//     var index = $.inArray(rowId, rows_selected);
                //
				//       // If checkbox is checked and row ID is not in list of selected row IDs
				//     if(this.checked && index === -1){
				//         rows_selected.push(rowId);
                //
				//       // Otherwise, if checkbox is not checked and row ID is in list of selected row IDs
				//     } else if (!this.checked && index !== -1){
				//         rows_selected.splice(index, 1);
				//     }
                //
				//     if(this.checked){
				//         $row.addClass('selected');
				//     } else {
				//         $row.removeClass('selected');
				//     }
                //
				//       // Update state of "Select all" control
				//     updateDataTableSelectAllCtrl(table);
                //
				//       // Prevent click event from propagating to parent
				//     e.stopPropagation();
				// });
                //
				//    // Handle click on table cells with checkboxes
			   	// $('#list_table').on('click', 'tbody td, thead th:first-child', function(e){
			    //   	$(this).parent().find('input[type="checkbox"]').trigger('click');
			   	// });
                //
			   	// // Handle click on "Select all" control
			   	// $('thead input[name="select_all"]', table.table().container()).on('click', function(e){
			    //   	if(this.checked){
			    //      	$('#list_table tbody input[type="checkbox"]:not(:checked)').trigger('click');
			    //   	} else {
			    //      	$('#list_table tbody input[type="checkbox"]:checked').trigger('click');
			    //   	}
			   	// });
			});
		</script>
	</body>
</html>
